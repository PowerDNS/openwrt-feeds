<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>OpenWrt repository for dnsdist | dnsdist packages for OpenWrt</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="OpenWrt repository for dnsdist" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="https://repo.powerdns.com/openwrt/" />
<meta property="og:url" content="https://repo.powerdns.com/openwrt/" />
<meta property="og:site_name" content="dnsdist packages for OpenWrt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="OpenWrt repository for dnsdist" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebSite","headline":"OpenWrt repository for dnsdist","name":"dnsdist packages for OpenWrt","url":"https://repo.powerdns.com/openwrt/"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/openwrt/assets/css/style.css?v=d1a2eb4cf61aed3e382fa7e2fd8620495115d9b6">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/openwrt/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="https://repo.powerdns.com/openwrt/">dnsdist packages for OpenWrt</a></h1>
      

      <h1 id="openwrt-repository-for-dnsdist">OpenWrt repository for dnsdist</h1>

<p>Download the <a href="/openwrt/public.key">signing key</a>, add it to your device with <code class="language-plaintext highlighter-rouge">opkg-key add public.key</code>, and then select the version that matches your device (check <code class="language-plaintext highlighter-rouge">/etc/openwrt_release</code> or the LuCI status page):</p>

<ul>
  <li><a href="OpenWrt_23.05/">OpenWrt 23.05</a></li>
  <li><a href="OpenWrt_22.03/">OpenWrt 22.03</a></li>
  <li><a href="OpenWrt_21.02/">OpenWrt 21.02</a></li>
  <li><a href="/openwrt/public.key">Signing key</a></li>
</ul>

<p>These repositories offer two versions of dnsdist:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">dnsdist</code>: <code class="language-plaintext highlighter-rouge">Enabled features: dns-over-tls(openssl) dns-over-https(DOH) outgoing-dns-over-https(nghttp2)</code></li>
  <li><code class="language-plaintext highlighter-rouge">dnsdist-full</code>: <code class="language-plaintext highlighter-rouge">Enabled features: cdb dns-over-tls(gnutls openssl) dns-over-https(DOH) dnscrypt ebpf fstrm ipcipher libeditr libsodium lmdb outgoing-dns-over-https(nghttp2) protobuf re2 snmp</code></li>
</ul>

<p>If you do <a href="https://github.com/PowerDNS/openwrt-feeds/tree/main/package">your own builds based on our package definition</a> you can also build a version that is exactly right for your needs.</p>

<h2 id="installation-instructions">Installation instructions</h2>

<p>Download and install the signing key:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@OpenWrt:~# cd /tmp
root@OpenWrt:/tmp# wget https://repo.powerdns.com/openwrt/public.key
Downloading 'https://repo.powerdns.com/openwrt/public.key'
Connecting to 188.166.116.224:443
Writing to 'public.key'
public.key           100% |*******************************|   118   0:00:00 ETA
Download completed (118 bytes)
root@OpenWrt:/tmp# opkg-key add public.key
</code></pre></div></div>

<p>Then, pick your OpenWrt version above, followed by your architecture (see <code class="language-plaintext highlighter-rouge">opkg print-architecture</code> to find the right one).
Follow the instructions there (at least the <code class="language-plaintext highlighter-rouge">echo</code>), then continue reading here.</p>

<p>With the feed configured, three packages become available:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">dnsdist</code></li>
  <li><code class="language-plaintext highlighter-rouge">dnsdist-full</code></li>
  <li><code class="language-plaintext highlighter-rouge">dnsdist-maindns</code></li>
</ul>

<p>See above for an explanation of <code class="language-plaintext highlighter-rouge">dnsdist</code> and <code class="language-plaintext highlighter-rouge">dnsdist-full</code>.</p>

<p><code class="language-plaintext highlighter-rouge">dnsdist-maindns</code> is a meta package that configures dnsdist to replace dnsmasq.</p>

<p>Because <code class="language-plaintext highlighter-rouge">opkg</code> has limited conflict resolution, installation takes an extra step:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@OpenWrt:~# opkg remove odhcpd-ipv6only
Removing package odhcpd-ipv6only from root...
root@OpenWrt:~# opkg install dnsdist-maindns
Installing dnsdist-maindns (1.8.0-pdns5) to root...
Downloading https://repo.powerdns.com/openwrt/OpenWrt_22.03/arm_cortex-a9_vfpv3-d16/dnsdist/dnsdist-maindns_1.8.0-pdns5_all.ipk
Installing odhcpd (2023-01-02-4a673e1c-2) to root...
Downloading https://downloads.openwrt.org/releases/22.03.2/packages/arm_cortex-a9_vfpv3-d16/base/odhcpd_2023-01-02-4a673e1c-2_arm_cortex-a9_vfpv3-d16.ipk
Configuring odhcpd.
odhcpd
Configuring dnsdist-maindns.

dnsmasq disabled, odhcpd set up, dnsdist enabled
Please reboot

root@OpenWrt:~# reboot
</code></pre></div></div>

<p>If, after reboot, DNS does not work, and <code class="language-plaintext highlighter-rouge">logread</code> shows a line like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dnsdist[3112]: No downstream servers defined: all packets will get dropped
</code></pre></div></div>

<p>then make sure that whatever configures your WAN fills <code class="language-plaintext highlighter-rouge">/tmp/resolv.conf.d/resolv.conf.auto</code> correctly.
As a workaround until you debug that problem, you can do:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@OpenWrt:~# echo nameserver 9.9.9.9 &gt; /tmp/resolv.conf.d/resolv.conf.auto
root@OpenWrt:~# /etc/init.d/dnsdist restart
</code></pre></div></div>

<p>This workaround example uses Quad9â€™s resolver (which dnsdist will auto-upgrade to DoT).
You can of course substitute your own preferred resolver.</p>

<!-- 2 -->


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>
